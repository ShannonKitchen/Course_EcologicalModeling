---
layout: topic
title: "Homework 3"
output: html_document
---

```{r include = FALSE}
# This code block sets up the r session when the page is rendered to html
# include = FALSE means that it will not be included in the html document

# Write every code block to the html document 
knitr::opts_chunk$set(echo = TRUE)

# Write the results of every code block to the html document 
knitr::opts_chunk$set(eval = TRUE)

# # Define the directory where images generated by knit will be saved
# knitr::opts_chunk$set(fig.path = "images/03-A/")

# Set the web address where R will look for files from this repository
# Do not change this address
repo_url <- "https://raw.githubusercontent.com/LivingLandscapes/Course_EcologicalModeling/master/"

# Suppress warnings and messages
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

```

## Overview

Please provide a reproducible .Rmd script to address the scenario below and produces all of your analysis and plots. Some reminders:

- **Reproducible:** This means when I run your .Rmd file, it will run all analyses and create all plots without errors, without me having to reset my working directory, and without forcing me to install anything on my machine (i.e., use the require(librarian); shelf(your packages, lib = tempdir()) approach as in the code block below). This also means there should be *NO ERRORS* when I run it!
- **Format:** In the .Rmd file, arrange and format similar to a scientific article. Specifically, I want to see 1) an analytical methods section, 2) a results section that includes figures, tables, and *text interpreting the figures and tables and model(s)*!, and 3) a brief conclusion (1 - 2 paragraphs) based on the results. **NOTE:** You do not need to create an introduction, reiterate the data collection methods, or produce a literature cited section!

### Background

<p>
!["Cirsium vulgare plant2" by Harry Rose is licensed under CC BY 2.0.](https://github.com/LivingLandscapes/Course_EcologicalModeling/raw/master/images/CirsiumVulgare_HarryRose.jpg){width=400px}
<p>

One hypothesis for why some plants are able to invade novel ecosystems is that they “escape” the effect of herbivory by moving to the new environment. Bull Thistle (*Cirsium vulgare*) is a exotic plant introduced to North America from Eurasia. In many parts of the United States it is considered a highly invasive noxious plant.  In Nebraska however, it appears to be present but not reaching high abundances, even after many decades of establishment. There is a native thistle, the Tall Thistle (*Cirsium altissimum*), which flowers simultaneously with Bull Thistle. Many of the native herbivores found on Tall Thistles also attack Bull Thistle, and can consume up to 90% of all viable seeds. Could these native herbivores be suppressing invasive Bull Thistle populations, and could that suppression be related to distance from native Tall Thistle patches?

### The scenario

Hi! I'm a graduate student, and I set up an experiment testing the effects of distance to tall thistle patch on bull thistle seedling establishment density. I didn't  talk to a statistician before designing the experiment, which I know is a big no-no... So I know this is a big ask, but I **really** need your expert statistical advice! Here's the info on my experiment:

I established $4m^2$ plots of bull thistle seedlings at five distances (0, 7.5, 15, 30 and 60 meters) from a tall thistle patch.  I did not attempt to control the presence or abundance of other patches of tall thistle at the site. At each distance, I established an insecticide (insect herbivory reduced) and control (insect herbivory present) plot.  I sowed a fixed weight of Bull thistle seeds into the plots in April (538 seeds/ $4m^2$) and censused seedling density per $1m2$ subplots the following September across all distances for insecticide and control plots.  I repeated this experimental design in 10 sites in Washington and southern Benton counties.  Additionally, I clumped sites into regions (4 regions), adding a second layer of spatial complexity. All sites within a region are closer to each other than in other regions.  Region 1 is comprised of 3 sites at Healing Springs Natural Area, region 2 is a single site at Woolsey Wet Prairie, region 3 includes 3 sites Wilson Springs Preserve, and region 4 includes 3 sites at the Milo J. Shult Agricultural Research Center (the UA "farm").  

I tried a two way ANOVA for an initial analysis. But according to the ANOVA, there didn't appear to be an effect of distance! This is devastating to the enemy release hypothesis, and I'm afraid I'm going to have to completely rewrite my thesis!  I heard you just learned about mixed modeling. Could you *please* run a generalized or linear mixed model on my data and see if it picks up a different signal?!?     

### Data description

+ Region: the larger spatial grouping of sites.  All sites within the same region are within 1 km of each other.  
+ Site: a full set of the experimental treatments
+ Distance: distance (m) of bull thistle patch to a tall thistle patch
+ Spray: insecticide vs control
+ Plot: there are 10 plots at each site, labeled by the spray treatment and distance
+ Subplot: Each 4m2 plot is divided into 4-1m2 plots 
		
 
```{r eval = FALSE, message = FALSE, include = TRUE}

# List of packages necessary to run this script:
require(librarian, quietly = TRUE)
shelf(tidyverse,
      MuMIn,
      lme4,
      DHARMa,
      broom.mixed,
      performance,
      quiet = TRUE,
      lib = tempdir())

# Set the web address where R will look for files from this repository
# Do not change this address
repo_url <- "https://raw.githubusercontent.com/LivingLandscapes/Course_EcologicalModeling/master/data/"

# Load data
thistles <- read.csv(paste0(repo_url,
                            "C_vulgare_seedling_dataset.csv"))

```

The top row is the insecticide (“i”) plots, bottom row is control plots (“c”). There are four points at each distance for the four subplots. You also need to setup the factors for region, site, plot and subplot thus:

```{r eval = FALSE, message = FALSE, include = TRUE}

thistles$region = factor(thistles$region)
thistles$site = factor(thistles$site)
thistles$plot = factor(paste(thistles$spray, thistles$distance, sep = "."))
thistles$subplot = factor(thistles$subplot)

```

## Your assignment

Using these data, apply your knowledge of (generalized?) linear mixed models to determine if there is support for the enemy release hypothesis.  *Remember:* not only are you analyzing the data, but you are also doing a post-mortem on the experiment/data collection/study design. Make sure to do model diagnostics and include any glaring issues you identify in the Results. See the *Format* instructions in the Overview section for required format and elements.