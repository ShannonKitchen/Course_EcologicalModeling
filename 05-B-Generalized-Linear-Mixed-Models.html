<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Generalized Linear Mixed Models</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data Exploration
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01-A-data-exploration.html">Lab</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Linear Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="02-A-linear-models-and-probability-distributions.html">Lab</a>
    </li>
    <li>
      <a href="02-B-Homework-01.html">Homework 1</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Model Selection
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03-A-model-selection.html">Lab</a>
    </li>
    <li>
      <a href="03-B-Homework-02.html">Homework 2</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Autocorrelation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04-A-Autocorrelation.html">Lab</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mixed Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="05-A-Linear-Mixed-Models.html">Lab: Linear Mixed Models</a>
    </li>
    <li>
      <a href="05-B-Generalized-Linear-Mixed-Models.html">Lab: Generalized Linear Mixed Models</a>
    </li>
    <li>
      <a href="05-C-Confidence-Intervals-Mixed-Models.html">Lab: Confidence Intervals for Mixed Models</a>
    </li>
    <li>
      <a href="05-C-Homework-03.html">Homework 3</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    HGAMs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-A-Hierarchical-Generalized-Additive-Models.html">Lab: HGAMs</a>
    </li>
    <li>
      <a href="06-B-Homework-04.html">Homework 4</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Hello, Bayes!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="07-A-Homework-05.html">Homeork 5</a>
    </li>
    <li>
      <a href="07-B-HelloBayes.html">Lab: Hello, Bayes!</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Generalized Linear Mixed Models</h1>

</div>


<p><strong>Assigned Reading:</strong></p>
<ul>
<li>Harrison XA, Donaldson L, Correa-Cano ME, Evans J, Fisher DN,
Goodwin CED, Robinson BS, Hodgson DJ, Inger R. 2018. A brief
introduction to mixed effects modelling and multi-model inference in
ecology. PeerJ 6:e4794 <a href="https://doi.org/10.7717/peerj.4794"
class="uri">https://doi.org/10.7717/peerj.4794</a>.</li>
<li>Oberpriller, J., de Souza Leite, M., &amp; Pichler, M. (2022). Fixed
or random? On the reliability of mixed‐effects models for a small number
of levels in grouping variables. Ecology and Evolution, 12(7),
e9062.</li>
</ul>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>To learn about generalized linear mixed models, we will use data from
the data are from Vicente et al. (2005) who looked at the distribution
and faecal shedding patterns of 1st stage larvae of <em>Elaphostrongylus
cervi</em> in red deer. Here we’re interested in the presence and
absence of larvae in deer as functions of size (length in cm), sex, and
farm identity. The study was done near Cuidad Real in Spain. Here’s a
nice pic of red deer at Cabañeros National Park in Spain, which is near
Ciudad Real (and Don Quixote territory):</p>
<p>
<img
src="https://github.com/LivingLandscapes/Course_EcologicalModeling/raw/master/images/reddeer.png"
width="600" />
<p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># List of packages necessary to run this script:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">require</span>(librarian, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">shelf</span>(tidyverse, </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>      performance, <span class="co"># For checking model convergence</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>      MuMIn, <span class="co"># for model selection</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>      lme4, <span class="co"># For mixed modeling</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>      <span class="co"># pander,</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>      lattice,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>      broom.mixed,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>      DHARMa, <span class="co"># For mixed model diagnostics</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>      <span class="at">lib =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>      <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># Set the web address where R will look for files from this repository</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># Do not change this address</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>repo_url <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/LivingLandscapes/Course_EcologicalModeling/master/&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>ecervi <span class="ot">&lt;-</span> </span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="fu">read.table</span>(<span class="fu">paste0</span>(repo_url, <span class="st">&quot;/data/DeerEcervi.txt&quot;</span>), </span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>             <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="data-exploration" class="section level3">
<h3>Data Exploration</h3>
<p><strong>On your own, familiarize yourself with the data.</strong> One
critical data exploration points: the average number of larvae in a
fecal sample is highly skewed to the right – many zeros but also some
very large values.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">hist</span>(ecervi<span class="sc">$</span>Ecervi,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Number of L1 E. cervi&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The response variable is continuous, so we need to do some data
manipulation in order to get presence/absence data. This is one way to
handle highly skewed data like this. While we’re doing that, we’ll make
sure sex is categorical and center the length variable to improve
convergence, and make the intercept directly interpretable as the
probability of presence for an average size deer.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Convert E cervi abundance to presence/absence (1 , 0), create a factor for</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># sex, and center the length variable by subtracting the mean.</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>ecervi <span class="ot">&lt;-</span> </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  ecervi <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ecervi.pa =</span> Ecervi <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>         <span class="at">fSex =</span> <span class="fu">factor</span>(Sex, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>)),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>         <span class="at">cLength =</span> Length <span class="sc">-</span> <span class="fu">mean</span>(Length))</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co"># Plot the potential relationship between cLength and E cervi abundance</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">ggplot</span>(ecervi, </span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> cLength, </span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>           <span class="at">y =</span> Ecervi,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>           <span class="at">color =</span> Farm)) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>) <span class="sc">+</span> </span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> fSex) <span class="sc">+</span> </span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>One issue that can affect a binomial model is called “complete
separation”. This arises when one predictor is a “perfect” predictor of
presence or absence. There is a value above which there are only
presences and below which there are only absences. The plot above
suggests that won’t be an issue with our fixed effects, but there could
be farms that are perfectly affected or unaffected.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Check if there is danger of &quot;complete separation&quot;. If there are farms without</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># any E cervi, that could be a problem.</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">with</span>(ecervi, </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>     <span class="fu">table</span>(Farm, Ecervi.pa))</span></code></pre></div>
<pre><code>##       Ecervi.pa
## Farm   FALSE TRUE
##   AL       9    6
##   AU       4   28
##   BA       9   41
##   BE       0   13
##   CB      26   59
##   CRC      1    0
##   HB      15    2
##   LN       3   30
##   MAN     16   11
##   MB       4   30
##   MO     127   82
##   NC      14   13
##   NV       9   11
##   PN       3   34
##   QM      12   48
##   RF       2   18
##   RN      16    7
##   RO       2   28
##   SAU      3    0
##   SE       6   20
##   TI       1   18
##   TN       7   18
##   VISO     2   11
##   VY       1    6</code></pre>
<p>There are 3 farms with either all positive or all negative
observations. We won’t worry about that for now, but we will want to
look for problems with that later.</p>
</div>
<div id="questing-for-the-global-glmm" class="section level3">
<h3>Questing for the global GLMM</h3>
<p>As always, start with a global model to check residuals. The global
model here has the interaction of sex and length. We clearly have a
repeated measures design, so we will start with a mixed model using Farm
as the random effect. It is also possible that the effects of sex and
length could vary by farm.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Global model: Take 1</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(Ecervi.pa <span class="sc">~</span> fSex <span class="sc">*</span> cLength <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> fSex <span class="sc">*</span> cLength <span class="sc">|</span> Farm), </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>            <span class="at">data =</span> ecervi, </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>            <span class="at">family =</span> binomial)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">summary</span>(M0)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: Ecervi.pa ~ fSex * cLength + (1 + fSex * cLength | Farm)
##    Data: ecervi
## 
##      AIC      BIC   logLik deviance df.resid 
##    841.9    907.9   -406.9    813.9      812 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.7870 -0.5971  0.2498  0.4947  3.1101 
## 
## Random effects:
##  Groups Name               Variance Std.Dev. Corr             
##  Farm   (Intercept)        2.163852 1.47100                   
##         fSexFemale         0.228874 0.47841  -0.06            
##         cLength            0.001641 0.04051   0.58  0.09      
##         fSexFemale:cLength 0.001296 0.03600  -0.48  0.66 -0.69
## Number of obs: 826, groups:  Farm, 24
## 
## Fixed effects:
##                    Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)         1.08697    0.35723   3.043  0.00234 **
## fSexFemale          0.65000    0.33597   1.935  0.05303 . 
## cLength             0.04370    0.01329   3.289  0.00101 **
## fSexFemale:cLength  0.03521    0.01782   1.976  0.04820 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) fSxFml cLngth
## fSexFemale  -0.246              
## cLength      0.325  0.036       
## fSxFml:cLng -0.191  0.526 -0.578
## optimizer (Nelder_Mead) convergence code: 0 (OK)
## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<p>That model fails to converge. Asking for the sex by length
interaction to vary among farms is probably too much given there are
some farms with relatively few observations. Looking at the summary,
especially the random effects estimates, it is clear that the scaling
between Sex and Length is very different. A 1 cm change in length is a
much smaller change than a change from male to female. This kind of
discrepancy can make it harder for a model to converge. If I rescale
‘Length’ by dividing through with the standard deviation the
coefficients for those two variables will be closer, and this can help
with convergence. I will also change the contrasts on Sex to “sum to
zero” contrasts, which has a similar beneficial effect to centering a
continuous variable.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Divide length by its standard deviation</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>ecervi <span class="ot">&lt;-</span> </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  ecervi <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">csLength =</span> cLength <span class="sc">/</span> <span class="fu">sd</span>(Length))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co"># &quot;Center&quot; the random effect of sex</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">contrasts</span>(ecervi<span class="sc">$</span>fSex) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">2</span>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co"># Global model: Take 2</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(Ecervi.pa <span class="sc">~</span> fSex <span class="sc">*</span> csLength <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> fSex <span class="sc">*</span> csLength <span class="sc">|</span> Farm), </span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>            <span class="at">data =</span> ecervi,</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>            <span class="at">family =</span> binomial)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co"># summary(M0)</span></span></code></pre></div>
<p>Still fails to converge. OK, let’s try the next simplest model,
leaving out the interaction in the random effect.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Global model: Take 3</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(Ecervi.pa <span class="sc">~</span> fSex <span class="sc">*</span> csLength <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> fSex <span class="sc">+</span> csLength <span class="sc">|</span> Farm), </span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>            <span class="at">data =</span> ecervi,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>            <span class="at">family =</span> binomial)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># summary(M0)</span></span></code></pre></div>
<p>That model also fails to converge! Let’s check the two simpler models
that allow fSex or csLength to vary across farms.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Simplified models:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>M0_LF <span class="ot">&lt;-</span> </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">glmer</span>(Ecervi.pa <span class="sc">~</span> fSex <span class="sc">*</span> csLength <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> csLength <span class="sc">|</span> Farm),</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>        <span class="at">data =</span> ecervi,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>        <span class="at">family =</span> binomial)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>M0_SF <span class="ot">&lt;-</span> </span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">glmer</span>(Ecervi.pa <span class="sc">~</span> fSex <span class="sc">*</span> csLength <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> fSex <span class="sc">|</span> Farm),</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>        <span class="at">data =</span> ecervi,</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>        <span class="at">family =</span> binomial)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co"># # </span><span class="al">NOTE</span><span class="co">: So we don&#39;t clutter things up, check the summaries on your own.</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co"># summary(M0_LF)</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co"># summary(M0_SF)</span></span></code></pre></div>
<p>Both of those models converge. Check residuals for both.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Get residuals with DHARMa: QQ plot and residuals vs. predicted</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>simulationOutput_LF <span class="ot">&lt;-</span> </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> M0_LF, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Plot residuals vs. group--farm in this case</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">plotResiduals</span>(simulationOutput_LF, <span class="at">form =</span> ecervi<span class="sc">$</span>Farm)</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<p>The QQ plot, tests, and residuals vs. predicted plots look fine, but
there appear to be issues with heteroscedasticity across farms.
<strong>On your own, check the residuals for the “SF” model, including
the ‘Farm’ group. Are there any differences? Which one looks like a
better model?</strong></p>
<blockquote>
<p>The residuals for the fSex random effect model look OK, but not quite
as good as the csLength random effect. This is particularly noticeable
in the plots of the residuals vs. fitted and residuals vs. csLength
plots.</p>
</blockquote>
</div>
<div id="model-selection" class="section level3">
<h3>Model selection</h3>
<p>So we have identified the global models and checked that they are
adequate. Next we need to make up a set of models and identify the best
ones using <span class="math inline">\(AIC_c\)</span>. We can build the
set with all possible random effects, and all possible fixed effects
models. The number of variables is small, so this will be a reasonable
thing to do–at least for the purposes of this lab…</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># All fixed effect combinations</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>fe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;fSex&quot;</span>,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>        <span class="st">&quot;csLength&quot;</span>,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>        <span class="st">&quot;fSex + csLength&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>        <span class="st">&quot;fSex * csLength&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># All random effect combinations</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>re <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(1 | Farm)&quot;</span>, </span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>        <span class="st">&quot;(1 | Farm) + (0 + fSex | Farm)&quot;</span>,</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>        <span class="st">&quot;(1 | Farm) + (0 + csLength | Farm)&quot;</span>,</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>        <span class="st">&quot;(1 | Farm) + (0 + fSex | Farm) + (0 + csLength | Farm)&quot;</span>,</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>        <span class="st">&quot;(1 + fSex | Farm)&quot;</span>,</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>        <span class="st">&quot;(1 + csLength | Farm)&quot;</span>)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co"># Get all combinations in a data.frame</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>forms <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">LHS =</span> <span class="st">&quot;Ecervi.pa ~&quot;</span>, </span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>                     <span class="at">fe =</span> fe, </span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>                     <span class="at">re =</span> re)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co"># Collapse into formulas for models</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>models <span class="ot">&lt;-</span> </span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>  forms <span class="sc">%&gt;%</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RHS =</span> <span class="fu">paste</span>(fe, re, <span class="at">sep =</span> <span class="st">&quot;+&quot;</span>),</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>         <span class="at">model =</span> <span class="fu">paste</span>(LHS, RHS))</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co"># Fit all the models</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models<span class="sc">$</span>model, </span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>               <span class="cf">function</span>(X) { </span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>                 <span class="fu">glmer</span>(X,</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>                       <span class="at">data =</span> ecervi,</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>                       <span class="at">family =</span> binomial)</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>               }</span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>)</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co"># Name the fitted objects in the list</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="fu">names</span>(fits) <span class="ot">&lt;-</span> models<span class="sc">$</span>model</span></code></pre></div>
<p>Some models may not have failed to converge. Use the handy
“check_convergence” function in the “performance” package to check the
list:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># # Check for convergence</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co"># lapply(fits, check_convergence)</span></span></code></pre></div>
<p>Now we’re ready to see which models are the best, keeping a wary eye
out for the model(s) that did not converge…</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Using MuMIn for model selection</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>modSelection <span class="ot">&lt;-</span> <span class="fu">model.sel</span>(fits)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># modSelection</span></span></code></pre></div>
<p><strong>On your own, interpret the model selection table. Which model
or models should we use going forward?</strong></p>
<p>Critically, one difference from the “regular” linear mixed model with
normal error distributions is that we don’t have to switch off REML
estimation to compare models with different fixed effects.
<code>glmer()</code> is already using maximum likelihood for
everything.</p>
<p>For simplicity’s sake, let’s go ahead and use the top model:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>topmod <span class="ot">&lt;-</span> fits<span class="sc">$</span><span class="st">`</span><span class="at">Ecervi.pa ~ fSex * csLength+(1 + csLength | Farm)</span><span class="st">`</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co"># summary(fits$`Ecervi.pa ~ fSex * csLength+(1 + csLength | Farm)`)</span></span></code></pre></div>
<p>Next we want to make some plots of the effects so we can interpret
what is going on. First we’ll create some new data and go from there as
we have in the past. The additional wrinkle is that we have to think
about what we want predict to do with the random effects. The first
option is to look at the “population average” response, which we do by
setting <code>re.form=~0</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Get range of &#39;csLength&#39; values</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>lr <span class="ot">=</span> <span class="fu">range</span>(ecervi<span class="sc">$</span>csLength)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co"># Create new data.frame for predictions</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">csLength =</span> <span class="fu">seq</span>(lr[<span class="dv">1</span>], lr[<span class="dv">2</span>], <span class="at">length =</span> <span class="dv">20</span>),</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>                  <span class="at">fSex =</span> <span class="fu">factor</span>(<span class="fu">levels</span>(ecervi<span class="sc">$</span>fSex)))</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co"># Unconditional prediction</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>nd<span class="sc">$</span>pp <span class="ot">&lt;-</span> </span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="fu">predict</span>(topmod,</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>          <span class="at">newdata =</span> nd,</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="co"># No need for plogis. Why?</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>          <span class="at">re.form =</span>  <span class="sc">~</span> <span class="dv">0</span>)</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co"># Plot unconditional prediction</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="fu">ggplot</span>(nd, <span class="fu">aes</span>(<span class="at">x=</span>csLength, <span class="at">y=</span>pp, <span class="at">col=</span>fSex)) <span class="sc">+</span> </span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Centered and scaled Length&quot;</span>) <span class="sc">+</span> </span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Probability of E. cervi infection&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="fu">aes</span>(<span class="at">x=</span>csLength), <span class="at">data=</span><span class="fu">filter</span>(ecervi, Ecervi.pa),<span class="at">sides=</span><span class="st">&quot;t&quot;</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="fu">aes</span>(<span class="at">x=</span>csLength), <span class="at">data=</span><span class="fu">filter</span>(ecervi, <span class="sc">!</span>Ecervi.pa),<span class="at">sides=</span><span class="st">&quot;b&quot;</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>These lines represent the effect of length and sex for a typical
farm.</p>
<p>Now, here’s an interesting challenge: <strong>On your
own:</strong></p>
<ul>
<li>Repeat the model selection process for fixed effects using
<code>glm()</code>, i.e. ignoring the correlation within farms.</li>
<li>Compare and contrast the results that you get, both the magnitude
and direction of the coefficients, as well as their relative standard
errors.</li>
</ul>
</div>
<div id="inference-with-mixed-models" class="section level3">
<h3>Inference with mixed models</h3>
<div id="bootstrapping" class="section level4">
<h4>Bootstrapping</h4>
<p>There is a significant and on-going debate about how best to do
inference with this sort of model. One way around the debate is to use
parametric bootstrapping to estimate things like the standard errors of
the predictions and confidence intervals on the coefficients.
<code>lme4</code> has a pre-made function to get confidence intervals on
the coefficients. <em>WARNING</em> this line of code will take &gt; 20
minutes to run. Forget about these unless you’ve got a lot of time.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Returns a matrix with estimates plus confidence intervals for all fixed and</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="co"># random effects parameters. </span><span class="al">NOTE</span><span class="co">: you can reduce the number of simulations to</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co"># speed it up.</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>topmod.CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(topmod, <span class="at">method =</span> <span class="st">&quot;boot&quot;</span>, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>topmod.CI</span></code></pre></div>
<p>This function draws random samples of the random effects and the
i.i.d. errors, generates a simulated response based on those error
values, and then re-estimates the model. The confidence limits are based
on the quantiles of the distribution of parameter estimates generated
from 500 simulations. If fitting the original model takes a couple
seconds, this routine will take 500 times as long to complete! You will
also probably see warnings about convergence failures – all this reminds
us that we’re out on the bleeding edge of computational statistics
here.</p>
</div>
<div id="profile-and-wald-intervals" class="section level4">
<h4>Profile and Wald intervals</h4>
<p>Profile intervals are also good, slow, but not as bad as
bootstrap.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># profile limits</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>topmod.profCI <span class="ot">&lt;-</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">confint</span>(topmod, <span class="at">method =</span> <span class="st">&quot;profile&quot;</span>, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)) </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># Wald limits</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>topmod.WaldCI <span class="ot">&lt;-</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">confint</span>(topmod, <span class="at">method =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">oldNames =</span> <span class="cn">FALSE</span>))</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co"># get rid of rownames</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="fu">rownames</span>(topmod.profCI) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="fu">rownames</span>(topmod.WaldCI) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co"># and change names to include type of CI</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="fu">names</span>(topmod.profCI) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Profile_CI2.5&quot;</span>, <span class="st">&quot;Profile_CI97.5&quot;</span>)</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="fu">names</span>(topmod.WaldCI) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Wald_CI2.5&quot;</span>, <span class="st">&quot;Wald_CI97.5&quot;</span>)</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co"># Get the coefficients from the top model, add the Wald and profile intervals,</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co"># do some data manipulation to prepare for ggplot.</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>topmod.CI <span class="ot">&lt;-</span> </span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(topmod) <span class="sc">%&gt;%</span> <span class="co"># add the profile intervals -- confint() uses a different order from tidy() </span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>  <span class="fu">cbind</span>(topmod.profCI[<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>),],</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>        topmod.WaldCI[<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>),]) <span class="sc">%&gt;%</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(term, estimate, Profile_CI2<span class="fl">.5</span>, </span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>                  Profile_CI97<span class="fl">.5</span>, Wald_CI2<span class="fl">.5</span>, Wald_CI97<span class="fl">.5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Profile_CI2<span class="fl">.5</span><span class="sc">:</span>Wald_CI97<span class="fl">.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(<span class="at">cols =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>                       <span class="at">delim =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>                       <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;level&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Estimate =</span> estimate, <span class="at">Type =</span> type, <span class="at">Term =</span> term) <span class="sc">%&gt;%</span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(Term, Estimate, Type),</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>              <span class="at">names_from =</span> level, </span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>              <span class="at">values_from =</span> value)</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="co"># Plot the profile and Wald confidence intervals on coefficients.</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="fu">ggplot</span>(topmod.CI, </span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Term, </span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>           <span class="at">y =</span> Estimate, </span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>           <span class="at">color =</span> Type)) <span class="sc">+</span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> CI2<span class="fl">.5</span>, </span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a>                    <span class="at">ymax =</span> CI97<span class="fl">.5</span>), </span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">yIntercept =</span> <span class="dv">0</span>),</span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> yIntercept),</span>
<span id="cb19-47"><a href="#cb19-47" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;darkred&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-48"><a href="#cb19-48" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey60&quot;</span>),</span>
<span id="cb19-49"><a href="#cb19-49" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb19-50"><a href="#cb19-50" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Term&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-51"><a href="#cb19-51" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Coefficient Estimate&quot;</span>)</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>It can be hard to see what is going on unless you use the “zoom” to
make this plot large enough for the term names to not overlap. So the
intervals for the intercept and sex effects are pretty close to the
“simple” Wald intervals. The intervals for csLength and the interaction
are longer with profile intervals, but at least they still exclude zero.
In addition, the profile method gives us intervals on the variance
parameters as well.</p>
<p>The reason it is hard to get confidence intervals on predictions is
because of the uncertainty in the variance parameters, which can be
substantial. The correlation coefficient includes zero, for example.
This makes sense, as the 2nd best model was a model that assumed the
random effects were uncorrelated.</p>
</div>
<div id="but-what-the-heck-is-a-profile-limit" class="section level4">
<h4>But what the heck <em>IS</em> a profile limit?</h4>
<p>The basic idea is best illustrated with a figure showing how the
log-likelihood of a model changes as one of the parameter values is
changed.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># get a profile for the fixed effect csLength</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>lengthProf <span class="ot">&lt;-</span> <span class="fu">profile</span>(topmod, <span class="at">which=</span><span class="st">&quot;csLength&quot;</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">xyplot</span>(lengthProf, <span class="at">absVal=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="05-B-Generalized-Linear-Mixed-Models_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The x-axis on that figure are values of the coefficient csLength. The
y-axis is a measure of the change in deviance as the coefficient is
moved away from the maximum likelihood estimate (the peak at the
bottom). The vertical and horizontal lines indicate 50%, 80%, 90%, 95%,
and 99% confidence intervals. As the parameter value moves away from the
MLE, the model’s log-likehood gets worse. Particular points along that
profile correspond to different critical points on chisquare
distribution with one degree of freedom.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
